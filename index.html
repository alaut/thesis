<div class="titlepage">
<p><embed src="logos/LogoOutline-Bleu.pdf"
style="width:3cm;height:3cm" /> <img src="logos/logo.png"
style="width:9cm;height:3cm" alt="image" /></p>
<p><strong>Longitudinal Space Charge Modeling in the CERN
PS</strong></p>
<p>Alexander J. Laut</p>
<p>A thesis presented for the degree<br />
<em>Master of Physics</em></p>
<p>Department of Physics<br />
Plasmas, Lasers, Accelerators and Tokamaks<br />
Paris-Saclay University<br />
</p>
<p>Orsay, France September 2021</p>
</div>
<h1 class="unnumbered" id="acknowledgements">Acknowledgements</h1>
<p>First, I’d like to thank my supervisor, Dr. Alexandre Lasheen, for
providing me this amazing opportunity to work at CERN and for being
extraordinarily accommodating throughout my technical studentship.
Logistically, he helped me navigate moving between countries and
continents during a particularly dynamic time in history. He was an
exquisite mentor, learning resource, and peer with whom I’m thankful for
having had the opportunity to work with. Additionally I’d like to thank
others within the SY-RF-BR section at CERN for their insight during
section meetings and other technical discussions.</p>
<p>I’d like to thank the professors at Université Paris-Saclay,
Jean-Marcel Rax, Guy Bonnaud and Sophie Kazamias, for encouraging me to
pursue the M2 GI (Grands-Instruments), subsequently named M2 PLATO
(Plasmas, Lasers, Accelerators and Tokamaks). This program was an
amazing learning experience as well as an opportunity to explore the
various scientific institutions located within France and
Switzerland.</p>
<p>I would also like to thank my previous employer, Jagadishwar
Sirigiri, and others at Bridge12, for the immense knowledge and
experience I accumulated while working there for almost 4 years as a
Scientist. Both the hands-on and analytic experiences I developed there
proved instrumental towards my success as a master’s student.</p>
<p>Lastly I’d like to thank my parents, Philip and Donna, and my sister
Gabrielle.Their all encompassing support, intrigue, and encouragement
with my endeavors as a young physicist/engineer has kept me
motivated.</p>
<h1 id="introduction">Introduction</h1>
<h2 id="cern-and-the-lhc">CERN and the LHC</h2>
<p>The European Organization for Nuclear Research, or CERN, is an
international institution tasked with providing particle accelerators to
scientists for purposes of conducting high energy physics experiments.
It is the home of the LHC (Large Hadron Collider) accelerator chain,
comprised primarily of LINAC4, the PS (Proton Synchrotron), the PSB
(Proton Synchrotron Booster), the SPS (Super Proton Synchrotron) and the
LHC itself, a particle accelerator with circumference of 27 kilometers
around. It is located across the Franco-Swiss border local to Lake
Geneva, the Jura mountains, and Mont Salève.</p>
<figure>
<img src="figs/1024px-Cern-accelerator-complex.svg.png" id="fig:cern"
alt="The CERN Accelerator Complex includes various particle injectors such as the PS and SPS, and large detection experiments such as ATLAS and CMS ." />
<figcaption aria-hidden="true">The CERN Accelerator Complex includes
various particle injectors such as the PS and SPS, and large detection
experiments such as ATLAS and CMS <span class="citation"
data-cites="forthomme_cern_2021"></span>.</figcaption>
</figure>
<p>The LHC collides energetic and intense proton bunches against one
other so that the resulting particles produced in these collisions can
be observed and analyzed. Upon analysis, these observations may provide
evidence for particle’s predicted to exist according to the Standard
Model of particle physics, namely the Higgs Boson. These particle’s may
vary in charge, spin, mass, momentum, etc. Often weakly interacting with
matter, so their qualities must be quantified through the use of large
particle detector systems. For example, the CMS (Compact Muon Solenoid)
experiment is comprised of solenoids to probe a particle’s momentum from
perceived magnetic rigidity, calorimeters to estimate particle energy
deposition, and micro-channel plates to qualify time-of-flight and
generalized position tracking measurements, as depicted in Figure <a
href="#fig:cms" data-reference-type="ref"
data-reference="fig:cms">1.2</a>.</p>
<figure>
<img src="figs/CMSslice_whiteBackground.png" id="fig:cms"
alt="Particles generated by proton-proton collisions within the LHC Radial pursue radial trajectories through the CMS detector ." />
<figcaption aria-hidden="true">Particles generated by proton-proton
collisions within the LHC Radial pursue radial trajectories through the
CMS detector <span class="citation"
data-cites="barney_cms_2016"></span>.</figcaption>
</figure>
<p>To verify the existence of the Higgs Boson, physicists must be able
to resolve the energy spectra corresponding to the various particles
produced in proton-proton collisions. To mitigate large experimental
uncertainty due to collision variance and the particle product
variability, the total number of interaction <em>events</em> must be
increased. This can be done by increasing the interaction luminosity
along with total acquisition time. We see in <a href="#eq:luminosity"
data-reference-type="eqref"
data-reference="eq:luminosity">[eq:luminosity]</a> how, for a bivariate
gaussian beam, the luminosity (<span
class="math inline">\mathcal{L}</span>) scales with number of bunches
<span class="math inline">n_B</span>, particles per bunch <span
class="math inline">N</span> and inversely with beam width <span
class="math inline">\sigma</span> per</p>
<p><span class="math display">\mathcal{L} = \frac{n_b
N^2f_{rep}}{4\pi\sigma_x\sigma_y}H_d
    \label{eq:luminosity}.</span></p>
<p>Because acquisition time is already a strong limitation, there is an
ever persistent effort to improve the beam luminosity, effectively
defined by the quality of the injectors. This is the motivation behind
the HL-LHC (High Luminosity LHC) initiative whose goal is to increase
beam luminosity by a factor of 10 <span class="citation"
data-cites="aberle_high-luminosity_2020"></span>. The LIU (LHC Injectors
Upgrade) project is directed to upgrading the injectors to deliver the
required additional beam brightness <span class="citation"
data-cites="damerau_lhc_2014"></span>.</p>
<h2 id="space-charge-limitations">Space-Charge Limitations</h2>
<p>As particle beam intensities are increased to improve luminosity, the
electromagnetic fields of charged particle bunches will self-interact.
This interaction, named <em>space-charge</em>, may cause the bunch to
repel apart, break up, or induce other instabilities and perturbations
yielding to overall transmission loss. In the transverse plane,
maintaining a tight beam size is accomplished through the use of strong
focusing optics and by reaching higher beam energies whereas in the
longitudinal plane, space-charge becomes critical during injection and
extraction where the efficiency of transferring bunches from one ring to
the next is highly dependent on how short the bunch length can be kept.
Instabilities that can lengthen the bunch length can therefore
negatively impact total beam brightness factored towards the LHC.</p>
<p>As will be discussed further in the text, a particle within a bunch
will experience a longitudinal <em>induced voltage</em> <span
class="math display">\Delta V =
\frac{-i}{\omega_s}\frac{Z}{n}\frac{d\lambda}{d\tau}</span> dependent on
the <em>longitudinal space-charge impedance</em> given by <span
class="math display">\frac{Z}{n} = -i\frac{Z_0}{\beta\gamma^2}g</span>
which scales inversely with <span class="math inline">\beta
\gamma^2</span>. Accordingly, induced voltage due to space-charge is
generally a low energy effect except at the highest bunch
intensities.</p>
<p>Small perturbations and density fluctuations in the bunch’s
longitudinal charge density profile can create self amplifying wakefield
fluctuations that can lead to <em>micro-bunch instabilities</em>. As
observed in Figure <a href="#fig:microbunch_instabilities"
data-reference-type="ref"
data-reference="fig:microbunch_instabilities">1.3</a>, a narrow bunch
distribution can spontaneously split due to local fluctuations in the
bunch profile that have a negative feedback mechanism for promoting
further instabilities.</p>
<figure>
<img src="figs/micro_bunching_instabilities.PNG"
id="fig:microbunch_instabilities"
alt="Example of micro-bunch instabilities simulated in the longitudinal tracking code BLond. Small fluctuations in the longitudinal profile induce wakefield modulations which self-influence the bunch, inducing beam breakup." />
<figcaption aria-hidden="true">Example of micro-bunch instabilities
simulated in the longitudinal tracking code BLond. Small fluctuations in
the longitudinal profile induce wakefield modulations which
self-influence the bunch, inducing beam breakup.</figcaption>
</figure>
<h2 id="particle-injectors">Particle Injectors</h2>
<p>In the PS (Proton Synchrotron), the particle energy is accelerated
from 2-26 GeV in 3.6 seconds (Table <a href="#tab:ps_parameters"
data-reference-type="ref" data-reference="tab:ps_parameters">1.1</a>).
Accordingly where space-charge is an important consideration towards the
beginning of its ramp, at relativistic energies, the PS can neglect
space-charge towards extraction.</p>
<div id="tab:ps_parameters">
<table>
<caption>Updated Injection/Extraction parameters for PS at “flat-top"
and “flat-bottom" respectively after the injection energy was upgraded
from 1.4 to 2 GeV</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Symbol</th>
<th style="text-align: center;">Injection</th>
<th style="text-align: center;">Extraction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Circumference (m)</td>
<td style="text-align: center;">C</td>
<td colspan="2" style="text-align: center;">628</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kinetic Energy (GeV)</td>
<td style="text-align: center;">W</td>
<td style="text-align: center;">2.0</td>
<td style="text-align: center;">25.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lorentz Factor</td>
<td style="text-align: center;"><span
class="math inline">\gamma_s</span></td>
<td style="text-align: center;">3.1</td>
<td style="text-align: center;">28.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">Revolution Frequency (kHz)</td>
<td style="text-align: center;"><span
class="math inline">f_s</span></td>
<td style="text-align: center;">452</td>
<td style="text-align: center;">476</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RF Harmonic</td>
<td style="text-align: center;"><span class="math inline">h</span></td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">21</td>
</tr>
<tr class="even">
<td style="text-align: left;">RF Frequency (MHz)</td>
<td style="text-align: center;"><span
class="math inline">f_{RF}</span></td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Transverse Tune</td>
<td style="text-align: center;"><span class="math inline">Q_x,
Q_y</span></td>
<td colspan="2" style="text-align: center;">6.21, 6.24</td>
</tr>
<tr class="even">
<td style="text-align: left;">Transition Factor</td>
<td style="text-align: center;"><span
class="math inline">\gamma_t</span></td>
<td colspan="2" style="text-align: center;">6.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bunch Width (ns)</td>
<td style="text-align: center;"><span
class="math inline">\sigma_\tau</span></td>
<td style="text-align: center;">26</td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
</div>
<p>As seen in Figure <a href="#fig:ps_impedance"
data-reference-type="ref" data-reference="fig:ps_impedance">1.4</a>, the
space-charge impedance is nearly compensated by the ring’s effective
inductive impedance near transition energies at which point the
synchronism between RF systems, magnetic field ramp, and bunch phase,
requires dynamic adjustment to maintain longitudinal stability.
Accordingly there is a lot of potential for space-charge induced
instabilities to degrade the bunch during ramp and therefore is of
particular interest for space-charge studies.</p>
<figure>
<img src="figs/energy_v_space_charge_impedance.png"
id="fig:ps_impedance"
alt="Proton momentum (blue) compared with red (inductive impedance) during PS Ramp ." />
<figcaption aria-hidden="true">Proton momentum (blue) compared with red
(inductive impedance) during PS Ramp <span class="citation"
data-cites="lasheen_alexandre_ps_2020"></span>.</figcaption>
</figure>
<p>The luminosity of proton-proton collisions occurring within the LHC
is almost strictly defined by the beam intensity achieved from the
injector chain. At low energies and high intensities, as in LINAC4 and
the PS, space-charge effects are fighting to destabilize the beam, hence
motivation to raise the injection energy in the PS.</p>
<h2 id="rf-manipulations-in-the-ps">RF Manipulations in the PS</h2>
<p>Protons are injected into the PS from the four superimposed rings of
the PSB (Proton Synchrotron Booster) as depicted in Figure <a
href="#fig:ps_complex" data-reference-type="ref"
data-reference="fig:ps_complex">1.5</a>.</p>
<figure>
<img src="figs/pscomplex.png" id="fig:ps_complex"
alt="The PS complex , LINAC4 replacing LINAC2 (not pictured) as the start of the LHC injector chain." />
<figcaption aria-hidden="true">The PS complex <span class="citation"
data-cites="belleman_ps_2020"></span>, LINAC4 replacing LINAC2 (not
pictured) as the start of the LHC injector chain.</figcaption>
</figure>
<p>At these lower energies, space-charge dominates and accordingly
particle energies must be increased before bunches can be merged. As
observed in Figure <a href="#fig:bcms" data-reference-type="ref"
data-reference="fig:bcms">1.6</a>, the PS conducts a series of
<em>manipulations</em> where RF voltage profiles of varying harmonics
are used to position, accelerate, merge and then split the bunches
longitudinally according to the varying space-charge limitations. This
BCMS (batch compression matching and splitting) process is visualized in
Figure <a href="#fig:bcms" data-reference-type="ref"
data-reference="fig:bcms">1.6</a>.</p>
<figure>
<embed src="figs/allmanip.dat.pdf" id="fig:bcms" />
<figcaption aria-hidden="true">RF Manipulations conducted in the PS to
delay bunch merging until beam is relativistic where space-charge
becomes negligible.</figcaption>
</figure>
<p>These manipulations are accomplished by a complicated and dynamic RF
ramp scheme as depicted in Figure <a href="#fig:ps_ramp"
data-reference-type="ref" data-reference="fig:ps_ramp">1.7</a>. This is
accomplished through the use of various RF cavities space throughout the
PS ring.</p>
<figure>
<embed src="figs/ps_profiles.pdf" id="fig:ps_ramp" />
<figcaption aria-hidden="true">RF harmonic ramp profiles for
PS</figcaption>
</figure>
<h2 id="validation-of-longitudinal-space-charge-trackers">Validation of
Longitudinal Space-Charge Trackers</h2>
<p>When current space-charge approximations are incorporated into
longitudinal tracking codes such as BLonD <span class="citation"
data-cites="noauthor_cern_nodate"></span>, we can observe that the bunch
length oscillation amplitude and frequency can only be matched when
current space-charge calculations are reduced by roughly 30%, as seen in
Figure <a href="#fig:BlonD_v_experiment" data-reference-type="ref"
data-reference="fig:BlonD_v_experiment">1.8</a>. This discrepancy
suggests that there may exist an additional stabilizing phenomena within
which the current model for longitudinal space-charge impedance is
neglecting.</p>
<figure>
<img src="figs/simulation_v_experiment.png" id="fig:BlonD_v_experiment"
alt="Bunch length oscillation simulation (orange) benchmarked with experiment (black) ." />
<figcaption aria-hidden="true">Bunch length oscillation simulation
(orange) benchmarked with experiment (black) <span class="citation"
data-cites="lasheen_longitudinal_2021"></span>.</figcaption>
</figure>
<p>A possible candidate to describe this discrepancy may be related to
the fact that current longitudinal codes neglect transverse betatron
motion, suggesting that the variance in individual transverse particle
trajectories may lead to describing new phenomena in the longitudinal
plane.</p>
<h1 id="beam-dynamics">Beam Dynamics</h1>
<p>This chapter will briefly overview betatron motion in the transverse
plane followed by synchrotron motion in the longitudinal plane.
Furthermore, bunch wakefields and longitudinal space-charge impedance
will be presented to provide context for how particle bunches can
destabilize in longitudinal phase-space. The synchrotron frequency, a
parameter partially observable by experiment, will be described as will
the various ways in which space-charge can affect this quantity.</p>
<h2 id="transverse-beam-dynamics">Transverse Beam Dynamics</h2>
<h3 id="betatron-motion">Betatron Motion</h3>
<p>A particle’s transverse position <span
class="math inline">u(s)</span> (referring to horizontal or vertical
transverse positions <span class="math inline">x</span> and <span
class="math inline">y</span>), and derivative <span
class="math inline">u&#39;(s)=du/ds</span>, equivalent to particle
divergence within a focusing lattice, is characterized by the beta
function <span class="math inline">\beta(s)</span>, particle emittance
<span class="math inline">\epsilon</span>, and betatron phase <span
class="math inline">\phi</span> so that <span
class="math display">u_\beta(s)=\sqrt{\beta(s)\epsilon}\cos\phi \qquad
u_\beta&#39;(s)=-\sqrt{\frac{\epsilon}{\beta(s)}}\left(\alpha(s)\cos\phi+\sin\phi\right)
    \label{eq:hills_equations},</span> solutions to <em>Hill’s
Equations</em>. The phase advance <span
class="math inline">\mu(s)</span> from a particle’s initial phase offset
<span class="math inline">\mu_0</span> is given by <span
class="math display">\phi = \mu(s) + \mu_0 \qquad \mu(s) =
\int_0^s\frac{ds}{\beta(s)}.</span></p>
<p>Accordingly, betatron motion follows elliptical trajectories in
(<span class="math inline">u</span>-<span
class="math inline">u&#39;</span>) phase-space per it’s Twiss parameters
<span class="math inline">\alpha</span>, <span
class="math inline">\beta</span> and <span
class="math inline">\gamma</span> <span class="citation"
data-cites="courant_theory_1958"></span> such that <span
class="math display">\epsilon = \gamma u^2 + 2 \alpha u u&#39; + \beta
u&#39;^2.</span></p>
<p>Given a continuous beta function <span
class="math inline">\beta(s)</span>, the Twiss parameters can be
derived: <span class="math display">\alpha(s) =
-\frac{1}{2}\beta&#39;(s) \qquad \gamma(s) =
\frac{1+\alpha(s)^2}{\beta(s)}.</span></p>
<p>A particle’s relative momentum offset (<span
class="math inline">dp/p</span>) or dispersion (<span
class="math inline">\delta</span>) can be incorporated with betatron
motion by using the dispersion function <span
class="math inline">D(s)</span>: <span class="math display">u(s) =
u_\beta + u_D= \sqrt{\beta(s)\epsilon}\cos\phi + D(s)\delta</span>
resulting in the total transverse trajectories.</p>
<p>A bivariate transverse distribution (<span
class="math inline">x</span>-<span class="math inline">x&#39;</span>,
<span class="math inline">y</span>-<span
class="math inline">y&#39;</span>) can be statistically described by its
covariance matrix <span class="math inline">\Sigma</span>, the product
of its “root-mean-square" emittance <span
class="math inline">\epsilon</span>, and the Twiss matrix <span
class="math inline">\Omega</span>, encapsulating the focusing properties
of the present optics. The statistical emittance <span
class="math inline">\epsilon</span> can be described by the preserved
quantity the normalized emittance such that <span
class="math inline">\epsilon_n=\gamma\beta\epsilon</span>.</p>
<p><span class="math display">\Sigma = \begin{bmatrix}&lt;x^2&gt; &amp;
&lt;xx&#39;&gt; \\ &lt;x&#39;x&gt;&amp; &lt;x&#39;^2&gt;\end{bmatrix} =
\epsilon\Omega \qquad \Omega = \begin{bmatrix}\beta &amp;-\alpha \\
-\alpha &amp; \gamma\end{bmatrix} \qquad \epsilon =
\sqrt{\det(\Sigma)}</span></p>
<p>Such that an injected particle distribution’s covariance matrix
matches that of the optics <span class="math inline">\Omega</span>, the
collective motion of the bunch will be such that the beam width
throughout the ring can be described by : <span
class="math display">\begin{aligned}
        \sigma^2_x(s) &amp; = \beta_x(s)\epsilon_x+D(s)^2\sigma_\delta^2
\\
        \sigma^2_y(s) &amp; = \beta_y(s)\epsilon_y
    \end{aligned}.</span></p>
<p>As consistent in Figure <a href="#fig:ps_transverse_tracking"
data-reference-type="ref"
data-reference="fig:ps_transverse_tracking">2.1</a>, individual particle
trajectories are seen in faded paths whereas the bulk group motion is
described by the <em>beam envelope</em> as defined by the <em>strong
focusing</em> of the beam optics for a matched distribution.</p>
<figure>
<embed src="figs/ps_aperture.multivariate.pdf"
id="fig:ps_transverse_tracking" />
<figcaption aria-hidden="true">Depicted in faded lines, betatron motion
is shown for particles propagated through strong focusing optics in the
PS. The bulk motion is characterized by the beam envelope in solid lines
with respect to the beam pipe aperture.</figcaption>
</figure>
<h2 id="longitudinal-beam-dynamics">Longitudinal Beam Dynamics</h2>
<h3 id="single-particle-motion">Single Particle Motion</h3>
<p>As a particle is accelerated in a synchrotron, magnetic dipoles must
strengthen to maintain the particle’s trajectory as consistent with the
magnetic rigidity <span class="math display">B\rho=\frac{p}{q}</span>
where <span class="math inline">p</span> is particle momentum, <span
class="math inline">q</span> is charge, <span
class="math inline">\rho</span> is bending radius, and <span
class="math inline">B</span> is magnetic dipole field strength. The
particle energy gain per turn can be represented by the Panofsky
Equation <span class="citation"
data-cites="panofsky_considerations_1956"></span> <span
class="math display">\Delta W = q V_g\sin\varphi</span> where <span
class="math inline">V_g</span> represents the effective RF voltage of a
gap, and the RF phase <span class="math inline">\varphi</span> is
defined by <span class="math inline">\varphi=h\omega t</span> where
<span class="math inline">h</span> is the harmonic number of the RF with
respect to the angular velocity <span class="math inline">\omega</span>
of the particle revolution about the ring at absolute time <span
class="math inline">t</span>.</p>
<p>If the magnetic field is to be increased at a rate defined by <span
class="math inline">\dot{B}</span>, there exists a <em>synchronous</em>
phase <span class="math inline">\varphi_s</span> such that the
accelerating RF may be modulated so that the bending path of the
<em>synchronous particle</em> is maintained, given by <span
class="math display">\varphi_s=\arcsin\left(2\pi\rho
R\frac{\dot{B}}{V_g}\right)</span> where <span
class="math inline">R</span> defines the characteristic machine
radius.</p>
<p>In longitudinal phase-space, it is convenient to work in coordinates
relative to the synchronous particle where <span
class="math display">\tau = t - t_s \qquad \delta = \frac{p-p_s}{p_s}
\qquad \phi = \varphi - \varphi_s \qquad w = W-W_s</span> define the
relative time, momentum, RF phase and kinetic energy of an arbitrary
particle with respect to the synchronous particle.</p>
<p>The relative energy <em>kick</em> of a particle accelerated through
an RF gap is given by <span class="math display">\Delta w = q V(\tau)
\qquad
    V(\tau) = V_g g(\phi) \qquad
    g(\phi) = \sin\varphi-\sin\varphi_s.
    \label{eq:kick}</span> where the RF gradient <span
class="math inline">g(\phi)</span> yields the following derivative and
anti-derivatives <span
class="math display">g&#39;(\phi)=\cos(\varphi_s+\phi) \qquad
G(\phi)=(1-\cos\phi)\cos\varphi_s+(\sin\phi-\phi)\sin\varphi_s.</span></p>
<p>In a drift, a particle’s revolution period <span
class="math inline">T</span> evolves with total energy <span
class="math inline">E</span> given by <span
class="math display">\frac{dT}{T} = \frac{\eta}{\beta^2}\frac{dE}{E}
\qquad \eta =\alpha- \frac{1}{\gamma^2} \qquad \alpha =
\frac{dC/C}{dp/p} = \frac{1}{\gamma_t^2}
    \label{eq:drift}</span> where the slippage factor <span
class="math inline">\eta</span> is given by the momentum compaction
factor <span class="math inline">\alpha</span> and the particle’s
Lorentz factor <span class="math inline">\gamma</span> defined by it’s
transition energy <span class="math inline">\gamma_t</span>.</p>
<p>A particle’s evolution in phase-space can be described by combining
both the kick <a href="#eq:kick" data-reference-type="eqref"
data-reference="eq:kick">[eq:kick]</a> and drift <a href="#eq:drift"
data-reference-type="eqref" data-reference="eq:drift">[eq:drift]</a>
equations. For convenience, we introduce the following factor <span
class="math display">\kappa = \frac{\eta}{\beta_s^2E_s}</span>
generating the following equations of motion <span
class="math display">\dot{\tau} = \kappa w \qquad \dot{w} =
\frac{qV(\tau)}{T_s}
    \label{eq:eom}.</span></p>
<p>For a linear applied voltage <span class="math inline">V(\tau)</span>
where <span class="math inline">V(\tau) \approx V&#39;(\tau)\tau</span>,
the following phase equation for simple harmonic motion can be derived
<span class="math display">\ddot{\tau}+\Omega^2\tau = 0</span> such that
the oscillation frequency is given by <span class="math display">\qquad
\Omega^2 = -\frac{\kappa q}{T_s}V&#39;(\tau).</span> Therefore we can
identify that the amplitude of our synchrotron oscillation broadly
varies with the square of the effective voltage gradient <span
class="math display">\Omega \propto \sqrt{V&#39;(\tau)}.</span></p>
<p>For small-amplitude oscillations where <span class="math inline">\phi
\to 0</span>, <span class="math inline">g&#39;(\phi) \approx
\cos\varphi_s</span> therefore <span
class="math inline">V&#39;(\tau)\approx h\omega_s V_g
\cos\varphi_s</span> yielding the <em>Synchrotron Frequency</em> <span
class="math display">\Omega_s^2 =
-\frac{h\omega_s^2\eta}{\beta_s^2E_s}\frac{qV_g}{2\pi}\cos\varphi_s
    \label{eq:synchrotron_frequency}.</span></p>
<h3 id="hamiltonian-formulation">Hamiltonian Formulation</h3>
<p>Our equations of motion can be derived from the following Hamiltonian
<span class="math display">\begin{aligned}
        H &amp; = \frac{1}{2}\kappa w^2 -\frac{q}{T_s}\int V(\tau)d\tau
\\
          &amp; = \frac{1}{2}\kappa w^2 -\frac{q V_g}{2\pi h}G(\phi)
    \end{aligned}</span> such that Hamilton’s equations, <span
class="math display">\frac{dH}{dw} = \dot{\tau} \qquad -\frac{dH}{d\tau}
= \dot{w},</span> are obeyed.</p>
<p>A particle’s trajectory in phase-space can be represented by <span
class="math display">w(\tau) = \pm
\sqrt{\frac{2}{\kappa}\left(H+\frac{q}{T_s}\int V(\tau)
d\tau\right)}</span> where the conserved hamiltonion <span
class="math inline">H</span> can be defined by a particles maximum
phase-space amplitudes <span class="math inline">\hat{\phi}</span> and
<span class="math inline">\hat{w}</span> given by <span
class="math display">H = -\frac{qV_g}{2\pi h}G(\hat{\phi}) =
\frac{1}{2}\kappa \hat{w}^2.</span> Given that <span
class="math inline">\dot{\phi} = h\omega_s\dot{\tau}</span> and <span
class="math inline">W(\phi) = G(\phi)/\cos\varphi_s</span>, we can
define our particle trajectories arbitrarily by <span
class="math display">\dot{\phi} = \Omega_s
\sqrt{2(W(\hat{\phi})-W(\phi))}.</span></p>
<p>These trajectories are visualized in Figure <a href="#fig:fisheye"
data-reference-type="ref" data-reference="fig:fisheye">2.2</a>.
Particles oscillating near the center with small oscillation amplitudes
<span class="math inline">\hat{\tau}\to 0</span> remain elliptical
whereas particles with larger values in <span
class="math inline">\hat{\tau}</span> experience non-linear and
asymmetric RF forces, yielding a “fish" shape.</p>
<figure>
<embed src="figs/single_particle_motion/trajectories.pdf"
id="fig:fisheye" />
<figcaption aria-hidden="true">Particles initiated within the separatrix
(black contour) circulate along colored elliptical trajectories.
Particles initiated outside of the separatrix pursue unbound hyperbolic
trajectories.</figcaption>
</figure>
<p>The separatrix (in black) defines the contour of the Hamiltonian’s
local maximum such that particles within will retain stable
trajectories. Particles present outside the separatrix will follow
unstable trajectories.</p>
<h3 id="tune-spread">Tune Spread</h3>
<p>The synchrotron period (<span class="math inline">\Pi</span>) of a
particle with given oscillation amplitude <span
class="math inline">\hat{\phi}</span> between the left <span
class="math inline">\phi_L</span> and right <span
class="math inline">\phi_R</span> phase limits is computed by <span
class="math display">\Pi = \oint \frac{d\phi}{\dot{\phi}} =
\frac{2}{\Omega_s}\int_{\phi_L}^{\phi_R}
\frac{d\phi}{\sqrt{2(W(\hat{\phi})-W(\phi))}}.</span> For a
<em>non-accelerating bucket</em>, <span class="math inline">\varphi_s =
0</span>, therefore <span class="math inline">G(\phi) \to
\cos\varphi_s(1-\cos\phi)</span>, <span class="math inline">\phi_R =
\hat{\phi}</span> and <span class="math inline">\phi_L =
-\hat{\phi}</span> resulting in <span class="math display">\Pi =
\frac{4}{\Omega_s\sqrt{2}}\int_0^{\hat{\phi}}\frac{d\phi}{\sqrt{\cos\phi-\cos\hat{\phi}}}
= \frac{4K(\hat{\phi}/2; k=\csc(\hat{\phi}/2))}{\Omega_s}.</span> If we
define the normalized synchrotron tune <span
class="math inline">\mu</span> as <span class="math inline">\mu =
\Omega(\hat{\phi})/\Omega_s</span>, by Taylor series expansion we
produce <span class="math display">\mu
=\frac{\pi}{2K(\frac{\hat{\phi}}{2})} \approx 1-\frac{\hat{\phi}^2}{16}
+\mathcal{O}(\hat{\phi}^4) \qquad \phi \approx 4\sqrt{1-\mu}
    \label{eq:tune_spread}.</span> Accordingly, a distribution of linear
charge density <span class="math inline">\lambda(\phi)</span> an be
associated to a spread in normalized synchrotron tune <span
class="math inline">\mu</span> as displayed in Table <a
href="#tab:freq_spread" data-reference-type="ref"
data-reference="tab:freq_spread">2.1</a> and depicted in Figure <a
href="#fig:tune_spread" data-reference-type="ref"
data-reference="fig:tune_spread">2.3</a>.</p>
<div id="tab:freq_spread">
<table>
<caption>Impact of longitudinal distribution on synchrotron frequency
spread.</caption>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;"><span
class="math inline">\lambda(\phi)</span></th>
<th style="text-align: center;"><span
class="math inline">\lambda(\mu)</span></th>
<th style="text-align: center;"><span
class="math inline">d\lambda/d\phi</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Gaussian</td>
<td style="text-align: center;"><span
class="math inline">\frac{1}{\sigma_{\hat{\phi}}\sqrt{2\pi}}\exp\left(-\frac{1}{2}\frac{\hat{\phi}^2}{\sigma_{\hat{\phi}}^2}\right)</span></td>
<td style="text-align: center;"><span
class="math inline">\frac{1}{\sigma_{\hat{\phi}}\sqrt{2\pi}}\exp(-\frac{1}{2}\frac{16(1-\mu)}{\sigma_\phi^2})</span></td>
<td style="text-align: center;"><span
class="math inline">-\frac{\phi}{\sigma^2}\lambda(\phi)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;">Parabolic</td>
<td style="text-align: center;"><span
class="math inline">\frac{3}{2L_{\hat{\phi}}}(1-4\frac{\hat{\phi}^2}{L_{\hat{\phi^2}}})</span></td>
<td style="text-align: center;"><span
class="math inline">\frac{3}{2L^3}(L^2-64+64\mu)</span></td>
<td style="text-align: center;"><span
class="math inline">-\frac{12\phi}{L^3}</span></td>
</tr>
</tbody>
</table>
</div>
<figure>
<img src="figs/single_particle_motion/normalized_tune.png"
id="fig:tune_spread"
alt="Spread of synchrotron tune with oscillation amplitude" />
<figcaption aria-hidden="true">Spread of synchrotron tune with
oscillation amplitude</figcaption>
</figure>
<h2 id="longitudinal-space-charge">Longitudinal Space Charge</h2>
<p>The previous section describes the synchrotron motion of independent
particles to circulate within a quasi-elliptical RF bucket. The
electromagnetic interaction between particles was neglected and
accordingly will be accounted for in the following section. Firstly, the
interaction between a particle’s electromagnetic fields and the
surrounding conductive aperture, ie: the beam pipe, will be formalized
as a wakefield effect of reactive impedance sources. Additionally the
self-interaction of charged particles within a bunch can be described as
a space-charge impedance and represented as a similar wakefield
phenomenon.</p>
<h3 id="wakefields">Wakefields</h3>
<p>Consider charged particles in a bunch passing through a discontinuity
in a conductive aperture. The discontinuity will perturb the emitted
electromagnetic fields trailing the bunch and form wakefields that will
induce a voltage on the following particles. This induced voltage can be
given by the convolution of the linear charge density <span
class="math inline">\lambda(\tau)</span> and the wake function <span
class="math inline">\mathcal{W}(\tau)</span> given by <span
class="citation"
data-cites="wiedemann_particle_2015 zotter_impedances_1998"></span>
<span class="math display">\Delta
V(\tau)=-\int_0^\infty\lambda(t)\mathcal{W}(\tau-t)dt=-\mathcal{W}*\lambda</span>
where the bunch’s longitudinal charge profile <span
class="math inline">\lambda(\tau)</span> is normalized to the total
charge <span class="math inline">Q=qN_b</span> such that <span
class="math display">Q = \int_{-\infty}^\infty \lambda(\tau)
d\tau.</span></p>
<p>We can define the impedance <span class="math inline">Z(f)</span> and
spectrum <span class="math inline">S(f)</span> from the Fourier
transforms of the wake function <span
class="math inline">\mathcal{W}(\tau)</span> and charge profile <span
class="math inline">\lambda(\tau)</span> respectively given by <span
class="math display">Z(f)  =\int_{-\infty}^\infty\mathcal{W}(\tau)e^{-i\omega\tau}d\tau
\qquad
S(f)  =\int_{-\infty}^\infty\lambda(\tau)e^{-i\omega\tau}d\tau.</span>
The convolution of the wake function and linear charge density can be
written as the inverse Fourier transform of the product of the spectrum
and the impedance, therefore the induced voltage can be re-written as
<span class="math display">\Delta V(\tau)=-\int_{-\infty}^\infty
S(f)Z(f)e^{i\omega \tau}df.</span></p>
<p>For a linear reactive impedance source such that <span
class="math inline">Z/n</span> is constant, where <span
class="math inline">n = f/f_s</span>, the impedance term can be
separated from the integral so that the inverse Fourier transform of the
spectrum can be incorporated instead as the derivative of the linear
charge density <span class="math display">\Delta
V=\frac{-i}{\omega_s}\frac{Z}{n}\frac{d\lambda}{d\tau}
    \label{eq:induced_voltage}.</span></p>
<h3 id="space-charge-impedance">Space Charge Impedance</h3>
<p>The relativistic longitudinal self fields of a particle of a long
narrow beam can be defined by <span class="citation"
data-cites="ferrario_space_2014"></span> <span
class="math display">E_z=-\frac{\bar{g}}{2\pi\epsilon_0\gamma^2}\frac{\partial
\lambda}{\partial z},</span> where the <em>geometry factor</em> <span
class="math inline">\bar{g}</span> is defined by (<a
href="#eq:longitudinal_self_fields" data-reference-type="ref"
data-reference="eq:longitudinal_self_fields">[eq:longitudinal_self_fields]</a>)
<span
class="math display">\bar{g}=\int_r^b\frac{f(r&#39;)}{r&#39;}dr&#39;\qquad
f(r)=\frac{\int_0^r\rho(r&#39;)r&#39;dr&#39;}{\int_0^\infty\rho(r&#39;)r&#39;dr&#39;}=\frac{Q&#39;}{Q}.</span>
Here Q’ defines the amount of charge enclosed within the radius <span
class="math inline">r</span>. Averaged about a particle’s revolution
during one turn, these self fields will induce a voltage that can be
defined as the <em>Longitudinal Space-Charge Impedance</em> given by
<span class="citation" data-cites="lee_accelerator_2004"></span> <span
class="math display">\frac{Z}{n} = -i\frac{Z_0}{\beta\gamma^2}\bar{g}
    \label{eq:space_charge_impedance}.</span></p>
<p>The space-charge impedance can therefore be used to characterize the
effective voltage drop of particles within a bunch by combining
Equations <a href="#eq:induced_voltage" data-reference-type="ref"
data-reference="eq:induced_voltage">[eq:induced_voltage]</a> and <a
href="#eq:space_charge_impedance" data-reference-type="ref"
data-reference="eq:space_charge_impedance">[eq:space_charge_impedance]</a>
to yield our induced space-charge voltage <span
class="math inline">\Delta V_{SC}</span> as a function of the derivative
of linear charge density profile and the geometry factor.</p>
<p><span class="math display">\Delta V_{SC} =
-\frac{d\lambda}{d\tau}\frac{Z_0}{\beta_s\gamma_s^2}\frac{\bar{g}}{\omega_s}
    \label{eq:v_sc}</span></p>
<p>The geometry factors as a function of transverse radial position
<span class="math inline">\bar{g}(r)</span> for a uniform (<a
href="#eq:g_uniform" data-reference-type="ref"
data-reference="eq:g_uniform">[eq:g_uniform]</a>), parabolic (<a
href="#eq:g_parabolic" data-reference-type="ref"
data-reference="eq:g_parabolic">[eq:g_parabolic]</a>) and gaussian (<a
href="#eq:g_gaussian" data-reference-type="ref"
data-reference="eq:g_gaussian">[eq:g_gaussian]</a>) are depicted in
Figure <a href="#fig:geometry_factors" data-reference-type="ref"
data-reference="fig:geometry_factors">2.4</a>.</p>
<figure>
<embed src="./figs/geometric_factors.pdf" id="fig:geometry_factors" />
<figcaption aria-hidden="true">Geometric factors for uniform, parabolic
and gaussian charge profiles, sized with equivalent variances (<span
class="math inline">\sigma = a/2 = L/4</span>), with aperture radius
<span class="math inline">b</span>.</figcaption>
</figure>
<p>We observe that the shape of geometry factors for uniform, parabolic
or gaussian beams with similar variances is mostly preserved. The
geometry factor describing a uniform circular bunch of radius <span
class="math inline">a</span> in conducting aperture of radius <span
class="math inline">b</span> is given by <span
class="math display">\bar{g}(r)=\frac{1}{2}+\ln\frac{b}{a}-\frac{1}{2}\frac{r^2}{a^2}.</span>
The maximum geometry factor, <span
class="math inline">\bar{g}(r=0)</span>, corresponds to maximum
longitudinal space-charge effects. Particles with large dispersion
(<span class="math inline">\delta</span>) or transverse emittance (<span
class="math inline">\epsilon_\perp</span>) will follow misaligned
betatron trajectories with non-zero effective radial position, and
therefore will incur reduced space-charge effects as consistent with <a
href="#eq:v_sc" data-reference-type="eqref"
data-reference="eq:v_sc">[eq:v_sc]</a>.</p>
<h3 id="tune-shift">Tune Shift</h3>
<p>Relevant to the oscillation frequency, it is also worth defining the
space-charge impedance voltage gradient <span
class="math display">V&#39;_{SC}(\tau) =
\frac{Z_0}{\beta_s\gamma_s^2}\frac{\bar{g}}{\omega_s}\frac{d^2\lambda}{d\tau^2}.</span>
The <em>normalized tune shift</em> due to space-charge impedance is
therefore <span class="math display">\mu = \frac{\Omega}{\Omega_s} =
\sqrt{1 + \frac{V&#39;_{SC}}{V&#39;_{RF}} }= \sqrt{1 +\zeta\Lambda}
    \label{eq:tune_shift},</span> where <span
class="math inline">\zeta</span> is given by the maximum space-charge
impedance and <span class="math inline">\Lambda</span> describes
variation in geometry factor on account of transverse motion <span
class="math display">\zeta = \frac{V&#39;_{SC}(r=0)}{V&#39;_{RF}} \qquad
\Lambda = \frac{\bar{g}}{\bar{g}(r=0)}.</span></p>
<p>Considering a parabolic charge distribution where <span
class="math display">\lambda(\tau)=\frac{3Q}{2L_\tau}\left(1-4\frac{\tau^2}{L_\tau^2}\right)
\qquad |\tau| &lt; \frac{L_\tau}{2},</span> the charge gradient is
therefore given by <span class="math display">\frac{d\lambda}{d\tau} =
\frac{-12Q}{L_\tau^3}\tau</span> The induced voltage gradient of a
parabolic bunch due to space charge is given by <span class="citation"
data-cites="lasheen_longitudinal_2016"></span> <span
class="math display">V&#39;_{SC} = -\frac{12Q}{\omega_s}\frac{\Im
(Z)}{n}\frac{1}{L_\tau^3}=-\frac{12Q}{\omega_s}\frac{Z_0}{\beta_s\gamma_s^2}\frac{\bar{g}}{L_\tau^3}
    \label{eq:vp_sc}.</span> We see that <span
class="math inline">\zeta</span> is therefore a constant throughout
longitudinal phase-space, modulated only by the RF gradient <span
class="math inline">V&#39;_{RF}(\tau)</span>. For the on-axis particle
where <span class="math inline">\Lambda=1</span>, the synchrotron
frequency will experience a uniform shift due to space-charge as
observed in the tune distributions seen in Figure <a
href="#fig:tune_shift" data-reference-type="ref"
data-reference="fig:tune_shift">2.5</a>. Here we have assumed a uniform
space-charge geometry factor neglecting betatron motion and varying
aperture size, both to be addressed in the following chapters.</p>
<figure>
<img src="figs/tune_shift/normalized_tune.png" id="fig:tune_shift"
alt="Space-charge tune shift for 30 ns bunch, 2.08e12 protons, bunch" />
<figcaption aria-hidden="true">Space-charge tune shift for 30 ns bunch,
2.08e12 protons, bunch</figcaption>
</figure>
<h1 id="aperture-reconstruction">Aperture Reconstruction</h1>
<h2 id="introduction-1">Introduction</h2>
<p>As discussed in the previous chapter, the effects of longitudinal
space-charge impedance is described in part by a characteristic geometry
factor, describing the induced longitudinal fields due to the position a
particle occupies within a transverse bunch distribution in a finite
conducting aperture. To re-iterate, the geometry factor describing the
longitudinal fields felt of a particle within a uniform cylindrical
bunch can be described by <span class="math display">\bar{g}(r) =
\frac{1}{2} + \ln\frac{b}{a}-\frac{1}{2}\frac{r^2}{a^2}.</span></p>
<p>Much of this work revolves on accurately tracking and characterizing
the beam size (<span class="math inline">a</span>) and particle radius
(<span class="math inline">r</span>) relevant to this equation, however
the PS’s model for beam pipe aperture (<span
class="math inline">b</span>) is of unknown precision and many years out
of date, (circa 2013) to wit the updating of said aperture profile by
manual tallying is time consuming, tedious, and error prone.</p>
<figure>
<embed src="figs/ps_aperture.pdf" id="fig:ps_aperture_model" />
<figcaption aria-hidden="true">Current aperture model of PS, last
updated in 2013</figcaption>
</figure>
<p>The most recent model, as depicted in Figure <a
href="#fig:ps_aperture_model" data-reference-type="ref"
data-reference="fig:ps_aperture_model">3.1</a>, is old and assumes for
elliptical geometries. Though this is mostly valid for most of the ring,
being an elliptical beam pipe, 35 x 73 mm wide, there are numerous
nuanced cross sections of varying components such as septa, bellows,
pump-out ports, etc. whose electrical boundaries aren’t incorporated
into this model.</p>
<h2 id="linearizing-a-synchrotron">Linearizing a Synchrotron</h2>
<p>The PS and it’s sub-assemblies can be conveniently represented as
triangular meshes, portable in STL (stereo-lithography) files, as
depicted in Figure <a href="#fig:ps_mu" data-reference-type="ref"
data-reference="fig:ps_mu">3.2</a>.</p>
<figure>
<img src="figs/ps_magnet.png" id="fig:ps_mu"
alt="Triangular mesh representation (front and right views) of a PS Dipole Magnet Unit (MU)" />
<figcaption aria-hidden="true">Triangular mesh representation (front and
right views) of a PS Dipole Magnet Unit (MU)</figcaption>
</figure>
<p>The first objective is to define a reference-trajectory <span
class="math inline">R(\phi)</span> in curvilinear coordinates consistent
with a “Frenet-Serret" coordinate system such that a torus can be
“inflated" until collision with the electrical aperture of the model are
identified. Our cartesian model can be described by toroidal coordinates
(<span class="math inline">r,\theta,\phi</span>) from: <span
class="math display">\begin{aligned}
        x &amp; = (R(\phi)+r\cos\theta)\cos\phi \\
        y &amp; = (R(\phi)+r\cos\theta)\sin\phi \\
        z &amp; = r\sin\theta,
    \end{aligned}</span> where <span class="math inline">R(\phi)</span>
serves the reference radius as is defined by the geometry of the PS’s
100 straight sections (SS) and 100 magnet units (MU). A schematic of the
reference trajectory for one of the PS’s 36<span
class="math inline">^\circ</span> sub-sectors is depicted belpw in
Figure <a href="#fig:ref_traj" data-reference-type="ref"
data-reference="fig:ref_traj">3.3</a>.</p>
<figure>
<img src="figs/reference_trajectory_path.jpg" id="fig:ref_traj"
alt="Engineering drawing of reference trajectory in a PS sector" />
<figcaption aria-hidden="true">Engineering drawing of reference
trajectory in a PS sector</figcaption>
</figure>
<p>We can use this definition of reference trajectory <span
class="math inline">R(\phi)</span> to “unwrap" the PS ring model into
equivalent <em>linearized</em>, transforming our model coordinates into
curvilinear <span class="math inline">(x, y, s)</span> and so to detect
the aperture, a straight cylinder originating about the reference
trajectory needs to be "inflated" until an intersection between surfaces
is detected and recorded.</p>
<p><img src="figs/ps_linac.png" alt="image" /> <span id="fig:ps_linac"
label="fig:ps_linac"></span></p>
<h2 id="ray-casting">Ray Casting</h2>
<p>To perform this virtual <em>inflation</em> of our collision surface
with the mechanical model, the <em>Möller–Trumbore</em> intersection
algorithm can be used to compute intersection angles with the PS <span
class="citation" data-cites="moller_fast_1997"></span>. It is commonly
used in 3D graphics to efficiently detect and compute the intersection
between light rays and polygons as well is it easily parallelized. In
Figure <a href="#fig:ray_casting" data-reference-type="ref"
data-reference="fig:ray_casting">3.4</a>, a point source is cast through
a spherical shell to demonstrate the technique. The algorithm is able to
evaluate each light ray with all faces to determine if an intersection
is possible and if so, where. Details for this algorithm are elucidated
in Appendix <a href="#eq:moller" data-reference-type="ref"
data-reference="eq:moller">[eq:moller]</a>.</p>
<figure>
<embed src="figs/shell.pdf" id="fig:ray_casting" />
<figcaption aria-hidden="true">Rays originating from a point source are
cast through a spherical shell. Intersecting faces are outlined in red
with intersection point indicated by red markers.</figcaption>
</figure>
<h2 id="reconstruction-quality">Reconstruction Quality</h2>
<p>After transforming the cartesian mechanical model of the PS to
curvilinear coordinates, a line source was “illuminated" along the
central beam path whose ray intersections were detected. These
illuminations were performed on each of the 100 magnet units and
straight sections individually and then combined to produced an updated
and detailed aperture as depicted in <a href="#fig:ps_aperture"
data-reference-type="ref" data-reference="fig:ps_aperture">3.5</a>. The
distinctive colors of the newly defined aperture coincide with a
preservation for component granularity, being able to attribute specific
aperture coordinates along the beam path with a particular magnet unit
or straight section, allowing for easy verification.</p>
<figure>
<img src="figs/ps_aperture.png" id="fig:ps_aperture"
alt="Horizontal aperture of the reconstructed PS aperture by Ray-Casting, superimposed atop the 2013 model (black)" />
<figcaption aria-hidden="true">Horizontal aperture of the reconstructed
PS aperture by Ray-Casting, superimposed atop the 2013 model
(black)</figcaption>
</figure>
<p>By using this automated technique as opposed to manually generating
an aperture, details could be queried at much higher longitudinal and
poloidal resolutions, as seen in Figure <a
href="#fig:ps_aperture_hi_res" data-reference-type="ref"
data-reference="fig:ps_aperture_hi_res">3.6</a>. Additionally, features
for smaller and yet frequent discrepancies could be automatically
identified as in the case of pump-out ports and bellows.</p>
<figure>
<img src="figs/apertture_hi_res.PNG" id="fig:ps_aperture_hi_res"
alt="Hi-Res reconstruction of PS aperture" />
<figcaption aria-hidden="true">Hi-Res reconstruction of PS
aperture</figcaption>
</figure>
<p>Additionally, details of RF cavities, diagnostic ports and septa can
be compared with that of the older model per Figure <a
href="#fig:ps_septa" data-reference-type="ref"
data-reference="fig:ps_septa">3.7</a>.</p>
<figure>
<img src="figs/aperture_comparison.PNG" id="fig:ps_septa"
alt="Comparison of updated aperture model with 2013 version (black)" />
<figcaption aria-hidden="true">Comparison of updated aperture model with
2013 version (black)</figcaption>
</figure>
<p>In summary, it has been shown that a high resolution aperture of the
PS can be automatically generated to be consistent with the 3D CAD model
generated by the mechanical team. This model can be conveniently
imported when changes are made, or on an automatic basis. This aperture
will contain much more detail than likely necessary for the purposed of
longitudinal-space charge studies, however this procedure may allow for
the approximation of no-elliptical geometries.</p>
<h1 id="simulation">Simulation</h1>
<h2 id="transverse-tracking">Transverse Tracking</h2>
<p>The optics of the PS are described by the beta function (<span
class="math inline">\beta(s)</span> and dispersion function <span
class="math inline">D(s)</span> as depicted in Figure <a
href="#fig:ps_optics" data-reference-type="ref"
data-reference="fig:ps_optics">4.1</a>.</p>
<figure>
<embed src="figs/ps_optics.pdf" id="fig:ps_optics" />
<figcaption aria-hidden="true">Transverse optics of the PS</figcaption>
</figure>
<p>For simplicity of transverse tracking purposes and subsequent
development of analytic relationships, the periodicity of these optics
can be accurately represented as a two-term Fourier series <span
class="math display">\beta(\theta) \approx \sum_k \beta_k e^{i k\theta}
\qquad D(\theta) \approx \sum_k D_k e^{i k\theta}
    \label{eq:optics_decomposition}</span> whose coefficients are
described in Table <a href="#tab:ps_optics_fourier"
data-reference-type="ref"
data-reference="tab:ps_optics_fourier">4.1</a>. This approximation
reduced the computation time for the subsequent transverse tracking
simulations and helped avoid interpolation artifacts.</p>
<div id="tab:ps_optics_fourier">
<table>
<caption>Primary Fourier coefficients describing periodic nature of PS
optics.</caption>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span
class="math inline">\beta_x(\theta)</span></td>
<td style="text-align: center;"><span
class="math inline">\beta_{0,x}</span></td>
<td style="text-align: right;">16.89</td>
<td style="text-align: center;"><span
class="math inline">\beta_{50,x}</span></td>
<td style="text-align: right;">+4.43-2.84i</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span
class="math inline">\beta_y(\theta)</span></td>
<td style="text-align: center;"><span
class="math inline">\beta_{0,y}</span></td>
<td style="text-align: right;">17.01</td>
<td style="text-align: center;"><span
class="math inline">\beta_{50,y}</span></td>
<td style="text-align: right;">-4.46+2.86i</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span
class="math inline">D_x(\theta)</span></td>
<td style="text-align: center;"><span
class="math inline">D_{0,x}</span></td>
<td style="text-align: right;">2.66</td>
<td style="text-align: center;"><span
class="math inline">D_{50,x}</span></td>
<td style="text-align: right;">+0.34-0.22i</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span
class="math inline">D_y(\theta)</span></td>
<td style="text-align: center;"><span
class="math inline">D_{0,y}</span></td>
<td style="text-align: right;">0</td>
<td style="text-align: center;"><span
class="math inline">D_{50,y}</span></td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<p>A transverse tracker was developed to solve for betatron trajectories
described by solutions to Hill’s Equations (Equations <a
href="#eq:hills_equations" data-reference-type="ref"
data-reference="eq:hills_equations">[eq:hills_equations]</a>). A
bivariate gaussian distribution with matching covariance matrix (<span
class="math inline">\Sigma</span>) to that of the PS’s Twiss matrix
(<span class="math inline">\Omega</span>) was “injected" and tracked
about one turn in the synchrotron as depicted in Figure <a
href="#fig:trans_tracking" data-reference-type="ref"
data-reference="fig:trans_tracking">4.2</a>.</p>
<figure>
<embed src="figs/tracking.pdf" id="fig:trans_tracking" />
<figcaption aria-hidden="true">Faded trajectories of select particles
alongside statistical (magenta) and analytic (black) beam widths in the
PS.</figcaption>
</figure>
<h3 id="effective-geometry-factor">Effective Geometry Factor</h3>
<p>Given the ability to track the transverse locations of individual
particles propagating through the PS lattice relative to the transverse
particle distribution itself, each particle’s geometry factor can be
computed and observed to vary along the ring. These geometry factors can
be averaged resulting in the definition of the effective geometry
factor, characterizing the particle’s turn-averaged experienced
space-charge, dependent on the optics, aperture, and the particle’s
characteristic emittance, phase advance and dispersion.</p>
<p><span class="math display">\bar{g}_{eff} \propto
\bar{g}(\epsilon_\perp, \mu_0, \delta)</span></p>
<p>The transverse tracker was accordingly used to build a response
matrix to predict a particle’s effective geometry factor given it’s
initial conditions (<span class="math inline">\epsilon_x, \epsilon_y,
\delta</span>) within a known beam of characteristic statistical
emittance and width (<span class="math inline">\epsilon_\perp,
\sigma_\delta</span>). In relation to dispersion, Figure <a
href="#fig:g_eff_dispersion" data-reference-type="ref"
data-reference="fig:g_eff_dispersion">4.3</a> indicates a parabolic
dependence with the effective geometry factor and a linear relationship
with transverse emittance. A particle’s phase-advance appears to have
minimal impact on the effective geometry factor.</p>
<p><span class="math display">\bar{g}_{eff} \propto \bar{g}_{max} -
C_0\delta^2 - C_1\epsilon_x - C_2\epsilon_y</span></p>
<figure>
<embed src="figs/g_dispersion.pdf" id="fig:g_eff_dispersion" />
<figcaption aria-hidden="true">Impact of particle
<strong>dispersion</strong> on effective geometry factor</figcaption>
</figure>
<p>We see however that the domain for <span
class="math inline">\bar{g}_{eff}</span> is limited as particles with a
combination of very high dispersion or very high emittance are will
collide with the beam aperture and be lost. This phenomena is more
readily visible in Figure <a href="#fig:g_emittance"
data-reference-type="ref" data-reference="fig:g_emittance">4.4</a> where
we see the thicker lines (representing higher dispersion) end up being
truncated with increased transverse emittance. This figure also more
clearly elucidates the exponential relationship between emittance and
the geometric factor when dispersion is low.</p>
<figure>
<embed src="figs/g_emittance.pdf" id="fig:g_emittance" />
<figcaption aria-hidden="true">Impact of particle
<strong>emittance</strong> on effective geometry factor</figcaption>
</figure>
<p>We see in Figure <a href="#fig:g_phase_advance"
data-reference-type="ref" data-reference="fig:g_phase_advance">4.5</a>
that though changes in geometry factor are dominated by dispersion and
particle emittance, along the course of a particle around it’s
elliptical trajectory in transverse phase-space, there will be a
sinusoidal impact on the geometry factor due to betatron phase-advance,
though this can largely be neglected.</p>
<figure>
<embed src="figs/g_phase_advance.pdf" id="fig:g_phase_advance" />
<figcaption aria-hidden="true">Impact of particle <strong>phase
advance</strong> on effective geometry factor</figcaption>
</figure>
<p>These relationships can be summarized in a lookup table represented
as a response matrix, visualized in Figure <a href="#fig:g_eff_vol"
data-reference-type="ref" data-reference="fig:g_eff_vol">4.6</a>.</p>
<figure>
<embed src="figs/g_eff.surface.0.pdf" id="fig:g_eff_vol" />
<figcaption aria-hidden="true">Multi-dimensional vector space of
effective geometry factor for a particle of known transverse emittance
and dispersion.</figcaption>
</figure>
<p>The impact of particle phase-advance was neglected as it’s effect are
minimal in comparison to the other dependencies on account of the fact
that the transverse tune is large and accordingly a variation in a
particle’s initial phase-offset will contribute to little variance in
the particle’s effective radial position.</p>
<h3 id="constant-focusing-approximation">Constant Focusing
Approximation</h3>
<h2 id="longitudinal-tracking">Longitudinal Tracking</h2>
<h3 id="usage-of-geometric-factor">Usage of Geometric Factor</h3>
<p>A longitudinal tracker can be developed by discretizing Equations <a
href="#eq:eom" data-reference-type="ref"
data-reference="eq:eom">[eq:eom]</a>, yielding the <em>turn-by turn</em>
“kick" and “drift" components respectively <span
class="math display">w_{i+1}-w_i \to \Delta w = qV(\tau) \qquad
\tau_{i+1}-\tau_i \to \Delta\tau = \kappa T_s w.</span> To include
space-charge in our tracker, the induced voltage due to space-charge
impedance is include with RF acceleration by <span
class="math display">V(\tau) = V_{RF} + V_{SC}.</span> The geometric
factor <span class="math inline">\bar{g}</span> is replaced as found in
<a href="#eq:space_charge_impedance" data-reference-type="eqref"
data-reference="eq:space_charge_impedance">[eq:space_charge_impedance]</a>
with the effective particle dependent geometry factor <span
class="math inline">\bar{g}_{eff}</span> for a parabolic longitudinal
bunch given by <span class="math display">V_{SC} =
-\frac{12Q}{L_\tau^2}\frac{Z_0}{\beta\gamma^3}\frac{g_{eff}(\epsilon_x,\epsilon_y,\delta)}{\omega_s}.</span></p>
<p>Transverse emittance <span class="math inline">\epsilon_x</span> and
<span class="math inline">\epsilon_y</span> is presumed to be preserved
between synchrotron “kicks", however dispersion evolves with synchrotron
motion and accordingly the geometry factor will notice an influence as
the particle orbits in longitudinal phase-space.</p>
<h3 id="tune-blur">Tune “Blur"</h3>
<p>Consider we sample our distribution from a 6D ellipsoidal
distribution associated with gaussian transverse emittance (<span
class="math inline">\epsilon_\perp</span>), uniform betatron phase
advance (<span class="math inline">\mu_0</span>), and gaussian
dispersion (<span class="math inline">\sigma_\delta</span>) and bunch
length (<span class="math inline">\sigma_\tau</span>). Using this
modified longitudinal tracker, the normalized tune distribution
incorporating the effective geometry factor due to transverse motion is
given by Figure <a href="#fig:tune_blurr" data-reference-type="ref"
data-reference="fig:tune_blurr">4.7</a> where we observe a “blurred”
tune spread distribution for the synchrotron frequency.</p>
<figure>
<img src="figs/tune_blurr/blurred_tune.png" id="fig:tune_blurr"
alt="Blurred Synchrotron Frequency spread distribution due to space-charge impedance with transverse motion" />
<figcaption aria-hidden="true">Blurred Synchrotron Frequency spread
distribution due to space-charge impedance with transverse
motion</figcaption>
</figure>
<p>To improve tracking statistics and make more visible the phenomena,
Figure <a href="#fig:full_comparison" data-reference-type="ref"
data-reference="fig:full_comparison">4.8</a> compares the three test
cases of synchrotron motion. Shown are select particles oscillating in a
matched bivariate matched bunch. Accordingly the longitudinal profile is
assumed to be a static 30 ns gaussian profile. In blue, we observe the
variation in synchrotron tune on account of the spiraling nature of the
oscillating particle front. In orange, we view a “dragging" particle
front due to coherent longitudinal space-charge impedance. In green, the
perceived phenomena of blurring is attributed to incoherent variation in
space-charge impedance due to geometry factor variation dependent on
varying particle emittance and dispersion.</p>
<figure>
<img src="figs/tune_blurr/trajectories.png" id="fig:full_comparison"
alt="Comparison of Synchrotron motion of “ghost particles&quot; in a matched longitudinal bunch for single-particle motion, coherent space-charge impedance and incoherent space-charge impedance incorporating betatron motion" />
<figcaption aria-hidden="true">Comparison of Synchrotron motion of
“ghost particles" in a matched longitudinal bunch for single-particle
motion, coherent space-charge impedance and incoherent space-charge
impedance incorporating betatron motion</figcaption>
</figure>
<p>The particles depicted are selected “ghost" particles visualized
within a non-oscillating matched longitudinal bunch. Accordingly, the
derivative term related to the longitudinal profile is non-varying as
the longitudinal profile is stable. Nonetheless we observe originally
the deviation between single-particle motion (<span
class="math inline">g=0</span>), coherent space-charge impedance <span
class="math inline">g(r=a)</span> and incoherent space-charge impedance
<span class="math inline">g(\delta, \epsilon_x, \epsilon_y)</span> which
approximates betatron motion, further depicted in Figure <a
href="#fig:tune_dist_blur" data-reference-type="ref"
data-reference="fig:tune_dist_blur">4.9</a>.</p>
<figure>
<img src="figs/tune_blurr/normalized_tune.png" id="fig:tune_dist_blur"
alt="Blurring of synchrotron oscillation frequency due to Transverse Motion" />
<figcaption aria-hidden="true">Blurring of synchrotron oscillation
frequency due to Transverse Motion</figcaption>
</figure>
<h3 id="bunch-stability">Bunch Stability</h3>
<p>A standard <em>dipole-oscillation</em> measurement can be used to
probe the synchrotron frequency of a given longitudinal bunch
distribution. A bunch injected with an offset relative to the
synchronous phase will oscillate about the bucket center until it fully
filaments, reaching an equilibrium with greater <em>geometric
emittance</em>, as visible in Figure <a href="#fig:filamentation"
data-reference-type="ref"
data-reference="fig:filamentation">4.10</a>.</p>
<figure>
<img src="figs/dipole_oscillation.png" id="fig:filamentation"
alt="BLonD simulation of dipole oscillations" />
<figcaption aria-hidden="true"><strong>BLonD</strong> simulation of
dipole oscillations</figcaption>
</figure>
<p>Tune blurring may increase the observed filamentation rate of our
distribution. Frequently associated as a stabilizing effect, tune spread
filamentation will eliminate mismatched bunches or coherent bunch
perturbations by distributing these imperfections along Hamiltonian
contours. It is therefore reasonable to suspect that the impact of
transverse motion on space-charge impedance may provide additional
stability to longitudinal motion.</p>
<h1 id="md-experiments">MD Experiments</h1>
<h2 id="experimental-setup">Experimental Setup</h2>
<p>At CERN, within the CCC (CERN Command Center), a series of MD
Experiments (Manipulations Dynamiques) were conducted with the intention
to validate the proposed model for longitudinal space-charge. A bunch is
injected from the PSB to the PS wherein the RF properties define the
shape of the hamiltonion. Based on the injected bunch length, there
exists an optimally matched energy spread such that the bunch’s size in
longitudinal phase-space, it’s geometric emittance, remains preserved.
Accordingly, we can purposefully induce a mismatch by modulating the
nominal RF voltage within the PS during flat-bottom such that the
distribution will filament. This filamentation projected along the bunch
length will be observed as a bunch length oscillation, oscillating at
effectively twice the synchrotron frequency.</p>
<p>As the distribution filaments, the amplitude of these bunch length
oscillations will reduce until the bunch length has stabilized at a
greater equilibrium value. This decay is known as landau damping and the
effect of space-charge make’s uniform the synchrotron frequency of a
particle as a function of oscillation amplitude. Therefore without the
presence of tune spread, the distribution mismatch will not filament and
accordingly the bunch length oscillations will persist. This resistance
to oscillation decay as an effect is named "loss of landau damping".</p>
<p>Due to the effects of transverse motion, the net predicted effect is
that particles with larger betatronic orbits and high transverse
emittance will see effectively less space-charge and accordingly the
space-charge tune shift will be reduced. Accordingly, it may be
observable that the incorporation of the distributions transverse
emittance may be required to properly access the rate of loss of landau
damping as it may be observed that the filamentation rate or damping
rate may be higher than otherwise explainable without the incorporation
of effects of transverse motion.</p>
<p>Therefore, it will be important to induce bunch length oscillations
at varying levels of transverse emittance. Accordingly, as the
transverse emittance of a distribution is increased, the effect of
space-charge should reduce and accordingly we should observe a reduction
in loss of landau damping due to this effect.</p>
<h3 id="tomoscope">Tomoscope</h3>
<p>To monitor the longitudinal profile of the bunch within the PS, a
tomoscope is leveraged to provide linear profiles of each shot over the
course of several synchrotron periods such that the loss or lack thereof
of landau damping can be observed via the bunch length oscillations. The
tomoscope is an RF pickup that reports back the longitudinal density
profile which can be integrated to also suggest the total bunch
intensity.</p>
<p>These linear lineouts can be visualized as waterfall plots where the
horizontal axes represent time relative to the synchronous particle and
the vertical axes represents absolute time indicating as to the profile
evolution.</p>
<figure>
<img src="figs/md/low intensity/injosc.01x106_001.dat.exp.contour.png"
alt="Example of waterfall plot from MD experiment" />
<figcaption aria-hidden="true">Example of waterfall plot from MD
experiment</figcaption>
</figure>
<p>It can be observed that a bunch whose width or height is mismatched
will oscillate about an equilibrium bunch length which is achieved via
the filamentation mechanism. At each moment, the bunch’s effective
length can be tallied and accordingly one can see the effect as observed
as the decay of a damped harmonic oscillator. The relative oscillation
amplitude to that of the equilibrium bunch length can be used to
interpolate what the bunch’s effective energy spread must have been at
injection, which can be further modified by changing the bucket height
via modulation of the RF voltage hamiltonion.</p>
<h3 id="wire-scanner">Wire Scanner</h3>
<p>Generally, great care is taken throughout the various injectors to
minimize transverse emittance. Typically this improves injection
efficiency, reduces losses and improves total beam brightness. In this
experiment however, it became relevant to know the transverse bunch size
and have the ability to independently control this parameter while
observing other effects in the longitudinal plane. The simplest way to
modify the transverse emittance was therefore by slewing a bending
magnet (injection kicker, see )</p>
<figure>
<img src="figs/Image Pasted at 2022-2-28 09-14.png"
alt="Example of modification of injector settings to disturb the transverse emigttance." />
<figcaption aria-hidden="true">Example of modification of injector
settings to disturb the transverse emigttance.</figcaption>
</figure>
<p>to mismatch the acceptance ellipse in transverse phase-space,
broadening the beam. The wire scanner operates by passing a conductive
wire through the beam such that the voltage readout on the wire is
proportionate to the charge density of the intercepted bunch. This is
done at high speed so that the wire doesn’t melt upon beam heating. The
transverse bunch profile can therefore be reconstructed for a given
location, as is depicted in Figure <a href="#fig:wire_scan"
data-reference-type="ref" data-reference="fig:wire_scan">5.1</a>.</p>
<figure>
<img src="figs/md/wire_scan.png" id="fig:wire_scan"
alt="Example of Wire Scan showing transverse bunch profile from which transverse emittance can be deduced." />
<figcaption aria-hidden="true">Example of Wire Scan showing transverse
bunch profile from which transverse emittance can be
deduced.</figcaption>
</figure>
<p>A gaussian profile is fit to the data from which rms beam width’s are
interpreted and averaged. The transverse emittance can therefore be
deduced from the transverse beam optics. During the MD experiment, the
transverse beam size and accordingly transverse emittance was varied
independently of the bunch intensity as depicted in Figure <a
href="#fig:ws_data" data-reference-type="ref"
data-reference="fig:ws_data">5.2</a>.</p>
<figure>
<embed src="figs/md/ws_data.pdf" id="fig:ws_data" />
<figcaption aria-hidden="true">Transverse emittance and bunch intensity
throughout the duration of the MD experiment.</figcaption>
</figure>
<p>During this experiment, the transverse beam emittance was slew from
1.2-3 um in the horizontal direction and from 0.5-2 um in the vertical
direction. Independently the beam intensity was varied from between
50-300e10 protons per bunch, accommodating the full range where
space-charge effects can be shown to be negligible to significant.</p>
<h3 id="bunch-length-oscillations">Bunch Length Oscillations</h3>
<p>To induce bunch length oscillations of appropriate amplitude, a
longitudinal phase-space mismatch was made using the experimental
parameters as see in Table <a href="#tab:md_params"
data-reference-type="ref" data-reference="tab:md_params">5.1</a>.</p>
<div id="tab:md_params">
<table>
<caption>Experimental Parameters for
"MD5463_LongSpaceCharge_h8"</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Variable</th>
<th style="text-align: center;">Value</th>
<th style="text-align: center;">Unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">RF Voltage</td>
<td style="text-align: center;"><span
class="math inline">V_g</span></td>
<td style="text-align: center;">80</td>
<td style="text-align: center;">kV</td>
</tr>
<tr class="even">
<td style="text-align: left;">RF Harmonic</td>
<td style="text-align: center;"><span class="math inline">h</span></td>
<td style="text-align: center;">8</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bunch Length</td>
<td style="text-align: center;"><span class="math inline">L</span></td>
<td style="text-align: center;"> 30</td>
<td style="text-align: center;">ns</td>
</tr>
<tr class="even">
<td style="text-align: left;">Acquisition time</td>
<td style="text-align: center;"><span class="math inline">t</span></td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">ms</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bunch Intensity</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;"><span class="math inline">&lt;</span>
300e10</td>
<td style="text-align: center;">protons</td>
</tr>
<tr class="even">
<td style="text-align: left;">Transverse Emittance</td>
<td style="text-align: center;"><span
class="math inline">\sigma\epsilon</span></td>
<td style="text-align: center;">0.5-3</td>
<td style="text-align: center;">um</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Transition</td>
<td style="text-align: center;"><span
class="math inline">\gamma_t</span></td>
<td style="text-align: center;">6.1</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">RF Frequency</td>
<td style="text-align: center;"><span
class="math inline">f_{RF}</span></td>
<td style="text-align: center;">452.370</td>
<td style="text-align: center;">kHz</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
</div>
<p>An 85 kV voltage was applied to induce a mismatch with oscillation
amplitude of 6 ns from a baseline 27 ns or so equilibrium oscillation
amplitude. At low intensity, we can observe the following longitudinal
bunch profile evolution with time, oscillating at roughly twice the
synchrotron frequency, as shown in Figure <a href="#fig:waterfall"
data-reference-type="ref" data-reference="fig:waterfall">5.3</a>.</p>
<figure>
<img src="figs/md/injosc.01x106_098.dat.exp.waterfall.png"
id="fig:waterfall"
alt="Waterfall plot showing time evolution of longitudinal bunch profile oscillating in bunch length at roughly twice the synchrotron frequency. Dashed lines represent a quasi-gaussian fit used to characterize the instantaneous bunch length." />
<figcaption aria-hidden="true">Waterfall plot showing time evolution of
longitudinal bunch profile oscillating in bunch length at roughly twice
the synchrotron frequency. Dashed lines represent a quasi-gaussian fit
used to characterize the instantaneous bunch length.</figcaption>
</figure>
<p>It is seen that a nice quasi-gaussian bunch is injected into the PS
from the PSB but due to the phase-space mismatch, a bunch length
contraction is observed as well as the associated side lobes classically
associated with synchrotron filamentation. The oscillation dampens until
an equilibrium bunch length is reached wherein the geometric emittance
is larger.</p>
<h2 id="analysis">Analysis</h2>
<p>The longituidinal bunch length profile derived from the tomoscope
only gives us a 1D projection of what is occurring in longitudinal
phase-space. The effect on the distributions energy spread can only be
deduced from tomography and an understanding of classical single
particle synchrotron motion. Due to the non-linearity in the
accelerating gradient along the longitudinal bunch profile, there exists
a non-uniform synchrotron frequency spread along the particle
distribution, meaning that particles revolve about the synchronous
particle along it’s respective hamiltonion contours at differing
revolution frequencies. This spread therefore induces filamentation
which acts as a potentially stabilizing phenomena, spreading
perturbations evenly throughout longitudinal phase-space.</p>
<p>Because of space-charge, the synchrotron frequency spread is reduced,
inducing the loss of landau damping. Landau damping can be characterized
by the reduction in bunch length oscillation amplitude with time. To
compare the effects of space-charge on this phenomena, both in
experiment and in simulation, a consistent means of both characterizing
the bunch’s instantaneous bunch length as well as fitting it’s damping
rate, must be attained.</p>
<h3 id="bunch-length">Bunch Length</h3>
<p>The longitudinal bunch profile of the PS bunch can be generalized by
a binomial approximation to a gaussian distribution.</p>
<p><span class="math display">f(x; m) =
\frac{2\Gamma(3/2+m)}{L\sqrt{\pi}\Gamma(1+m)}\left[1-4\left(\frac{x-\mu}{L}\right)^2\right]^m,</span></p>
<p>The variance of said distribution is given by</p>
<p><span class="math display">\sigma^2 =
\frac{L^2}{4}\frac{1}{3+2m}.</span></p>
<p>In the PS, general the shape factor <span class="math inline">\mu
\approx 1.2</span> and is consistent with an approximately parabolic
distribution in hamiltonion value.</p>
<figure>
<embed src="figs/binomial.0.pdf" id="fig:my_label" />
<figcaption aria-hidden="true">Example of various distributions provided
by modifying the shape parameter <span
class="math inline">\mu</span>.</figcaption>
</figure>
<p>A uniform, parabolic and gaussian distribution are described with
shape parameters <span class="math inline">\mu = 0, 1, \infty</span>
respectively.</p>
<h3 id="damped-harmonic">Damped Harmonic</h3>
<p>Given a minimization fit of the binomial function, a characteristic
bunch length can be assigned to describe the bunch length oscillation
amplitude with time. An example of this done in experiment at low
intensity can be seen in figure <a href="#fig:blo_decay_exp"
data-reference-type="ref"
data-reference="fig:blo_decay_exp">5.5</a>.</p>
<figure>
<img src="figs/md/injosc.01x106_098.dat.exp.decay.png"
id="fig:blo_decay_exp"
alt="Experimental example of landau damping in bunch length oscillation observed at low intensity." />
<figcaption aria-hidden="true">Experimental example of landau damping in
bunch length oscillation observed at low intensity.</figcaption>
</figure>
<p>By minimizing the parameters associated with the following
expression:</p>
<p><span class="math display">\sigma(t) = A\cos(\omega
t+\phi)\exp(-\lambda t)+\mu</span></p>
<p>we can for instance in this case deduce the equilibrium bunch length
to be 27 ns with an oscillation amplitude of 6 ns and a damping rate of
6 ms. The synchrotron frequency is shown to oscillate at 8.8 <span
class="math inline">\text{ms}^{-1}</span>.</p>
<h2 id="validation">Validation</h2>
<p>See the repository distributed at
<strong>alaut.github.io/sylt</strong> to see the details of the specific
longitudinal tracker. Accordingly, much of this section will be used to
accurately reproduce experimental results with simulation at low
intensity and then see how the effects of space-charge are appropriately
incorporated at higher intensity. Accordingly, it will become important
to be able to effectively match the intital conditions of experiment
with that of simulation. Namely the RMS energy spread and vane voltage
are the largest unknowns.</p>
<h3 id="initialization">Initialization</h3>
<h3 id="effective-vane-voltage">Effective Vane Voltage</h3>
<p>The observed synchrotron frequency in experiment is typically quite
different than that expected in simulation. This is mainly due to a
discrepancy between the applied and effective vane voltage in the RF
system. Per the equation of synchrotron frequency, all other parameters
being known with great certainty, a particles observed synchrotron
frequency can be used to deduce the vane voltage.</p>
<p>The synchrotron frequency deduced from bunch length oscillation
measurements is an effective average of varying frequencies along the
distribution for which is not uniform due to the nature of synchrotron
tune spread. Accordingly, the maximum synchrotron frequency which is
relevant for the definition of our simulation is some factor larger than
the average vane voltage, which is a function of the average synchrotron
frequency and the bunch length. Analytically for a gaussian bunch
distribution, without space charge effects, we can define the effective
vane voltage.</p>
<p><span class="math display">\begin{aligned}
\bar{\mu} &amp;= \oint \lambda(\phi) \mu(\phi) d\phi\\
&amp;=
\int_{-\infty}^\infty\frac{1}{\sqrt{2\pi\sigma_\tau^2}}\exp(-\frac{1}{2}\frac{\tau^2}{\sigma_\tau^2})(1-\frac{(h\omega_s\tau)^2}{16})d\tau\\
&amp;= 1-\frac{\sigma_\phi^2}{16}
\end{aligned}</span></p>
<p>where</p>
<p><span class="math display">\mu = \frac{\Omega}{\Omega_s}</span></p>
<p>accordingly the effective vane voltage can be scaled up by this
factor</p>
<p><span class="math display">\bar{V}_g = -\frac{(\Omega T)^2}{\kappa q
2 \pi h \cos(\varphi_s))}</span></p>
<p><span class="math display">\bar{\mu} = 1-\frac{(h \omega_s
\sigma_\tau)^2}{16}</span></p>
<p>therefore the peak vane voltage list given by:</p>
<p><span class="math display">V_g = \bar{V_g}/\bar{\mu}^2</span></p>
<h3 id="energy-spread">Energy Spread</h3>
<p>Given the bunch length and oscillation amplitude, the deduced energy
spread can be interpreted as follows</p>
<p><span class="math display">\sigma_\phi = h \omega
\sigma_\tau</span></p>
<p><span class="math display">\sigma_w =\sqrt{\frac{q V_g}{(|\kappa|\pi
h)(1-\cos(\sigma_\phi))}}</span></p>
<h3 id="comparison">Comparison</h3>
<p>- brightness curve - damping relationship</p>
<h3 id="adjustments">Adjustments</h3>
<p>Fudge factor on bunch length and intensity approximate 13</p>
<h1 id="conclusions">Conclusions</h1>
<ul class="incremental">
<li><p>tube blur introduced</p></li>
<li><p>brightness curve</p></li>
<li><p>great match at low intensity</p></li>
<li><p>fudge factor required at high intensity</p></li>
</ul>
<h1 id="space-charge-geometry-factors">Space Charge Geometry
Factors</h1>
<h2 id="fields-of-round-beams">Fields of Round Beams</h2>
<p>The longitudinal self fields for a round beam in a conductive pipe of
radius <strong>b</strong> is given by <span class="math display">E_z(r,
z) = -\frac{1}{\gamma^2}\frac{\partial}{\partial z}\int_r^bE_r(r&#39;,
z)dr&#39;.</span> such that the radial fields can be defined by <span
class="math display">E_r(r, z) =
\frac{\lambda(z)}{2\pi\epsilon_0}\frac{f(r)}{r}</span> where <span
class="math inline">\lambda(z)</span> describes the linear charge
density <span class="citation" data-cites="ferrario_space_2014"></span>.
Accordingly the longitudinal fields can be defined by <span
class="math display">E_z =
-\frac{\bar{g}}{2\pi\epsilon_0\gamma^2}\frac{\partial \lambda}{\partial
z}
    \label{eq:longitudinal_self_fields}.</span> where the <em>geometry
factor</em> <span class="citation"
data-cites="zotter_impedances_1998"></span> <span
class="math inline">\bar{g}</span> is given by <span
class="math display">\bar{g} =
\int_r^b\frac{f(r&#39;)}{r&#39;}dr&#39;</span> and the form factor <span
class="math inline">f(r)</span> is defined by <span
class="math display">f(r) =  \frac{1}{Q}\int_0^r \rho(r&#39;) r&#39;
dr&#39;,</span> where <span class="math inline">\rho</span> is the
radial charge density.</p>
<h2 id="geometry-factors">Geometry Factors</h2>
<h3 id="uniform-distribution">Uniform Distribution</h3>
<p>A uniform charge distribution in a cylindrical beam is defined by
constant surface charge density <span class="math display">\rho(r) =
\sigma = \frac{Q}{\pi a^2}.</span> Our form factor is therefore given by
<span class="math display">f(r) = \begin{cases}
        \frac{r^2}{a^2} &amp; r &lt; a \\
        1               &amp; r &gt; a
\end{cases}.</span> Therefore our radial fields are defined by <span
class="math display">E_r(r,z) = \begin{cases}
    \frac{\lambda(z)}{2\pi\epsilon_0}\frac{r}{a^2} &amp; r &lt; a \\
    \frac{\lambda(z)}{2\pi\epsilon_0}\frac{1}{r}   &amp; r &gt; a
\end{cases},</span> and the geometry factors is given by <span
class="math display">\begin{aligned}\bar{g}(r&lt;a) &amp;=
\int_r^a\frac{r&#39;}{a^2}dr&#39;+\int_a^b\frac{1}{r&#39;}dr&#39;
\\     \bar{g}(r&gt;a) &amp;=
\int_r^b\frac{1}{r&#39;}dr&#39;\end{aligned}</span> Therefore: <span
class="math display">\bar{g}(r) = \begin{cases}
        \ln(\frac{b}{a})+\frac{1}{2}-\frac{1}{2}\frac{r^2}{a^2} &amp; r
&lt; a \\
        \ln(\frac{b}{r})                                        &amp; r
&gt; a
    \end{cases}
    \label{eq:g_uniform}.</span></p>
<h3 id="parabolic-distribution">Parabolic Distribution</h3>
<p>A parabolic charge distribution of radius <span
class="math inline">a</span> yields the following charge profile: <span
class="math display">\rho(r) = \frac{2Q}{\pi
a^2}\left(1-\frac{r^2}{a^2}\right).</span> where <span
class="math display">Q = \int_0^a \rho(r) r dr.</span> The form factor
is given by <span class="math display">\begin{aligned}f(r&lt;a) =
\frac{2\pi}{Q}\int_0^r\rho(r&#39;)r&#39;dr&#39; \\ f(r &gt; a) =
1\end{aligned}</span> The form factor is therefore given by <span
class="math display">f(r) = \begin{cases}
2\frac{r^2}{a^2}-\frac{r^4}{a^4} &amp; r &lt; a\\
1 &amp; r &gt; a
\end{cases}</span> Therefore the geometric factor is given by <span
class="math display">\begin{aligned}
\bar{g}(r&lt;a) &amp; = \int_r^a
\frac{1}{r&#39;}\left(2\frac{r&#39;^2}{a^2}-\frac{r&#39;^4}{a^4}\right)dr&#39;+
\int_a^b\frac{1}{r&#39;}dr&#39; \\
\bar{g}(r&gt;a) &amp;= \int_r^b\frac{1}{r&#39;}dr&#39;
\end{aligned}</span> Therefore: <span class="math display">\bar{g}(r) =
\begin{cases}
        \ln\left(\frac{b}{a}\right)+\frac{a^2-r^2}{a^2}-\frac{a^4-r^4}{4a^4}
&amp; r &lt; a \\
        \ln(\frac{b}{a})                                                     &amp;
r &gt; a\end{cases}
    \label{eq:g_parabolic}.</span></p>
<h3 id="gaussian-distribution">Gaussian Distribution</h3>
<p>Given a radial charge distribution for a gaussian beam is defined by
<span class="math display">\rho(r) =
\frac{Q}{\sigma_r^2(\sqrt{2\pi})^2}\exp\left(-\frac{r^2}{2\sigma_r^2}\right)</span>
the form factor is generalized by <span class="math display">f(r) =
1-\exp\left(-\frac{r^2}{2\sigma_r^2}\right)</span> Therefore <span
class="math display">\begin{aligned}
        \bar{g}(r) &amp; =
\int_r^b\frac{1}{r&#39;}\left(1-\exp\left(-\frac{r&#39;^2}{2\sigma_r^2}\right)\right)dr&#39;                                            \\
             &amp; =\int_r^b\frac{dr&#39;}{r&#39;}
-\int_r^b\frac{1}{r&#39;}\exp\left(-\frac{r^2}{2\sigma_r^2}\right)dr&#39;                                     \\
             &amp; = \ln(r&#39;)\Big|_r^b
-\frac{1}{2}\text{Ei}\left(-\frac{r&#39;^2}{2\sigma_r^2}\right)\Big|_r^b                                       \\
             &amp; =
\ln\left(\frac{b}{r}\right)-\frac{1}{2}\left(\text{Ei}(-\frac{b^2}{2\sigma_r^2})-\text{Ei}(-\frac{r^2}{2\sigma_r^2})\right)
    \end{aligned}</span> Or more concisely <span
class="math display">\bar{g}(r) = \ln\frac{b}{r} +
\frac{1}{2}\left(\rm{Ei}(-\frac{1}{2}\frac{r^2}{\sigma_r^2})-\rm{Ei}(-\frac{1}{2}\frac{b^2}{\sigma_r^2})\right)
    \label{eq:g_gaussian}.</span> where the exponential integral <span
class="math inline">\text{Ei}</span> is defined by <span
class="citation" data-cites="abramowitz_handbook_2013"></span> <span
class="math display">\text{Ei}(x) = \int_{-\infty}^x
\frac{e^t}{t}dt.</span> The maximum value occurs at <span
class="math display">\bar{g}(r=0) =
\frac{1}{2}\left(\ln\left(\frac{b^2}{2\sigma_r^2}\right)+\Gamma(0,
\frac{b^2}{2\sigma_r^2}+\gamma\right)</span> where <span
class="math display">\Gamma(a, x) =
\frac{1}{\Gamma(a)}\int_0^xt^{a-1}e^{-t}dt</span> and the
Euler–Mascheroni constant is given by <span class="math display">\gamma
= \lim_{n\to\infty}\left(-\ln n +\sum_{k=1}^n\frac{1}{k}\right) \approx
0.57721.</span> The geometry factor can be approximated by that for a
truncated gaussian can be given by <span class="citation"
data-cites="ng_space-charge_2004 ng_physics_2006"></span> <span
class="math display">\bar{g}(r&lt;m\sigma_r) =
\frac{\gamma+2\ln\frac{b}{\sigma_r\sqrt{2}}+E_1(\frac{m^2}{2})}{1-\exp(-m^2/2)}.</span></p>
<h1 id="möllertrumbore-algorithm">Möller–Trumbore Algorithm</h1>
<p>This easily parallelized algorithm can efficiently detect and compute
the intersections of a ray <span class="math inline">q=(q_0, q_1)</span>
through a face <span class="math inline">p=(p_0, p_1, p_2)</span>. The
interaction between a ray and a face can be characterized as
<strong>intersecting</strong> and <strong>non-intersecting</strong></p>
<p><img src="figs/moller_trumbore.drawio.png" alt="image" /></p>
<p>The signed volumes of possible tetrahedron combinations is given by
<span class="math display">\begin{aligned}
    s_1 = \text{sign}(V(q_1, p_1, p_2, p_3))\\
    s_2 = \text{sign}(V(q_2, p_1, p_2, p_3))\\
    s_3 = \text{sign}(V(q_1, q_2, p_1, p_2))\\
    s_4 = \text{sign}(V(q_1, q_2, p_2, p_3))\\
    s_5 = \text{sign}(V(q_1, q_2, p_3, p_1))\\
\end{aligned}</span> where the volume of a tetrahedron is defined by
<span class="math display">V(a, b, c, d) = \frac{1}{6} \left((d-a) \cdot
((b-a) \times (c-a))\right).</span> An intersection exists if <span
class="math display">s_1 \neq s_2 \quad \&amp; \quad s_3 = s_4 \quad
\&amp; \quad s_4 = s_5.
    \label{eq:moller}</span> The intersection point <span
class="math inline">q_0</span> is then given by <span
class="math display">q_0 = q_1 + t (q_2-q_1) \qquad t = \frac{(p_1-q_1)
\cdot n}{(q_2-q_1) \cdot n} \qquad n = (p_2-p_1) \times
(p_3-p_1).</span></p>
